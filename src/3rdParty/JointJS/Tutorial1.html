<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="joint.css" />
    <script src="jquery.min.js"></script>
    <script src="lodash.min.js"></script>
    <script src="backbone-min.js"></script>
    <script src="joint.js"></script>	
</head>
<body>
  <div id="paper"></div>
  
  <script type="text/javascript">
	var constraint = g.ellipse(g.point(200, 150), 100, 80);

	var ConstraintElementView = joint.dia.ElementView.extend({

		pointerdown: function(evt, x, y) {
			var position = this.model.get('position');
			var size = this.model.get('size');
			var center = g.rect(position.x, position.y, size.width, size.height).center();
			var intersection = constraint.intersectionWithLineFromCenterToPoint(center);
			joint.dia.ElementView.prototype.pointerdown.apply(this, [evt, intersection.x, intersection.y]);
		},
		pointermove: function(evt, x, y) {
			var intersection = constraint.intersectionWithLineFromCenterToPoint(g.point(x, y));
			joint.dia.ElementView.prototype.pointermove.apply(this, [evt, intersection.x, intersection.y]);
		}
	}); 
  

	var graph = new joint.dia.Graph;

	var paper = new joint.dia.Paper({
		el: $('#paper'),
		width: 650,
		height: 400,
		gridSize: 1,
		model: graph,
		elementView: ConstraintElementView
	});
		
	var earth = new joint.shapes.basic.Circle({
		position: constraint.intersectionWithLineFromCenterToPoint(g.point(100, 100)).offset(-10, -10),
		size: { width: 20, height: 20 },
		attrs: { text: { text: 'earth' }, circle: { fill: '#2ECC71' } },
		name: 'earth'
	});
	graph.addCell(earth);

	var orbit = V('<ellipse/>');
	orbit.attr({ 
		cx: constraint.x, cy: constraint.y, rx: constraint.a, ry: constraint.b 
	});
	V(paper.viewport).append(orbit);

  </script>
</body>
</html>